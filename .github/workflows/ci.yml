name: Continuous Integration

on:
  push:
    branches: [ '**' ]
  pull_request:
    branches: [ master ]

env:
  OS: '"ubuntu-20.04", "windows-2019", "windows-2022"'
  PYTHON: '"3.10"'

jobs:
  development:
    name: "OS ${{ matrix.os }} - Python ${{ matrix.python-version }} - Development"
    runs-on: "${{ matrix.os }}"
#   env:
    strategy:
      matrix:
        os: ["ubuntu-20.04", "windows-2019", "windows-2022"]
        python-version: ["3.10"]
    steps:
      - uses: "actions/checkout@v2"
      - uses: "actions/setup-python@v2"
        with:
          python-version: "${{ matrix.python-version }}"
      - name: "Install pip"
        run: "make pip"
      - name: "Install pipenv"
        run: "make pipenv"
      - name: "Install dcr dependencies"
        run: "make pipenv_dev"
      - name: "Run Bandit for finding common security issues"
        run: |
          make bandit
      - name: "Run Flake8 for style guide enforcement"
        run: |
          make flake8
      - name: "Run MyPy for static typing"
        run: |
          make mypy
      - name: "Run PyLint for checking for errors in Python code"
        run: |
          make pylint
      - name: "Run pydocstyle for docstring style enforcement"
        run: |
          make pydocstyle
      - name: "Run pytest for writing better program"
        run: |
          make pytest

  production:
    name: "OS ${{ matrix.os }} - Python ${{ matrix.python-version }} - Production"
    runs-on: "${{ matrix.os }}"
    #   env:
    strategy:
      matrix:
        os: ["ubuntu-20.04", "windows-2019", "windows-2022"]
        python-version: ["3.10"]
    steps:
      - uses: "actions/checkout@v2"
      - uses: "actions/setup-python@v2"
        with:
          python-version: "${{ matrix.python-version }}"
      - name: "Install pip"
        run: "make pip"
      - name: "Install pipenv"
        run: "make pipenv"
      - name: "Install dcr dependencies"
        run: "make pipenv_prod"
      - name: "Compile the Python code"
        run: "make compileall"
